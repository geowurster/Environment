#!/usr/bin/env python


"""
Iterate over a date range.

$ iterdates 2015-01-01 2015-01-04
2015-01-01
2015-01-02
2015-01-03
2015-01-04
"""


import argparse
import datetime
import textwrap


def main():

    parser = argparse.ArgumentParser(
        description=textwrap.dedent("""
        Print a date range to stdout.

            $ iterdates 2015-01-01 2015-01-04
            2015-01-01
            2015-01-02
            2015-01-03
            2015-01-04
        """), formatter_class=argparse.RawTextHelpFormatter)
    parser.add_argument(
        'start', type=str, help="Start date.")
    parser.add_argument(
        'stop', type=str, help="Stop date (inclusive).")
    parser.add_argument(
        '--format', dest='str_fmt', metavar='STRFTIME', default='%Y-%m-%d',
        help="String formatter for output dates.  Also used to parse start "
             "and stop.")
    args = parser.parse_args()

    start_dt = datetime.datetime.strptime(args.start, args.str_fmt)
    stop_dt = datetime.datetime.strptime(args.stop, args.str_fmt)

    if start_dt >= stop_dt:
        argparse.ArgumentParser().exit(
            "ERROR: start is >= stop: {} >= {}".format(
                start_dt.strftime(args.str_fmt),
                stop_dt.strftime(args.str_fmt)))

    delta = datetime.timedelta(days=1)

    date = start_dt
    while date <= stop_dt:
        print(date.strftime(args.str_fmt))
        date += delta


if __name__ == '__main__':
    main()
